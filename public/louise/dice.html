<!DOCTYPE html>
<html lang="en, fr">
<head>
    <title>Dice Roller - Miphonya</title>
    <meta property="og:title" content="Dice Roller - Miphonya" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta property="twitter:card" content="summary_large_image" />
</head>
<body>
    <pre id="results">
    </pre>

    <script>
        function parseDiceNotation(notation) {
            const regex = /^\d+d\d+$/i;
            const match = notation.match(regex);
            if (!match) return null;

            const [rolls, sides] = notation.split('d').map(Number);
            if (rolls <= 0 || sides <= 0) return null;
            return { rolls, sides };
        }

        function rollDice(rolls, sides) {
            const results = [];
            for (let i = 0; i < rolls; i++) {
                results.push(Math.floor(Math.random() * sides) + 1);
            }
            return results;
        }

        function displayResults(notation, results) {
            const total = results.reduce((sum, roll) => sum + roll, 0);
            const rows = results.map((roll, index) => `║ ${index + 1}          │ ${roll.toString().padStart(3, ' ')} ║`).join('\n');

            const table = `╔════════════════════╗\n` +
                          `║       ${notation}        ║\n` +
                          `╠════════════╤═══════╣\n` +
                          `║   Résultat   │  Total  ║\n` +
                          `╟────────────┼───────╢\n` +
                          `${rows}\n` +
                          `╚════════════╧═══════╝`;

            document.getElementById('results').textContent = table;
        }

        function main() {
            const params = new URLSearchParams(window.location.search);
            const dice = params.get('dice');

            if (!dice) {
                document.getElementById('results').textContent = 'No dice notation found in the URL.';
                return;
            }

            const parsed = parseDiceNotation(dice);

            if (!parsed) {
                document.getElementById('results').textContent = 'Invalid dice notation. Use format XdY (e.g., 1d100, 4d6).';
                return;
            }

            const { rolls, sides } = parsed;
            const results = rollDice(rolls, sides);
            displayResults(dice, results);
        }

        window.onload = main;
    </script>
</body>
</html>
